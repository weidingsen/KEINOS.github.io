---
title: FFFTP inner error – ”No more async regist space”
author: KEINOS
type: post
date: 2012-01-12T16:00:00+00:00
url: /20120113_858
page_type:
  - default
post_views_count:
  - 394
categories:
  - FTP
  - Windows
tags:
  - FFFTP

---
<div class="section">
  <p>
    <img title="ffftp:No more async regist space" src="https://cdn-ak.f.st-hatena.com/images/fotolife/K/KEINOS/20120113/20120113113737.png" alt="img" /><img title="ffftp:AskAsyncDone called with unregisterd socket." src="https://cdn-ak.f.st-hatena.com/images/fotolife/K/KEINOS/20120117/20120117194751.png?1326797750" alt="img" />
  </p>
  
  <p>
    Xreaなどの格安サーバで、FFFTPを使っていると&#8221;No more async regist space&#8221;というメッセージが表示され、アプリが落ちる（FFFTPが強制終了する）ことがあります。また、その際に、ごくまれにですがアプリを再起動して、改めて接続しても&#8221;AskAsyncDone called with unregisterd socket.&#8221;エラーが発生して同じくアプリが終了するケースも。
  </p>
  
  <p>
    この現象に関して検索すると「PASV(パッシブ)モードを変更する」といった回答を見受けますが、恐らく改善されないでしょう。
  </p>
  
  <p>
    一番の原因は、サーバ側からのレスポンス（反応）が遅いためで、何度も待ちを食らったアプリ側が「待ち切れなくなったから帰る!」とアプリを終了してしまうのです。
  </p>
  
  <p>
    一番簡単な解決法は、安定したサーバに乗り換える事ですが、「せっかく安くすませているのに…」という方もいると思います。きちんと原因を知れば対策も見えてきてコストを安く抑えられると思うので、エラーに関する内容とレスポンスが遅くなる原因をまとめてみました。お手すきにご一読下さい。
  </p>
  
  <h4 id="outline__1">
    エラーの内容を知る
  </h4>
  
  <p>
    まずは、原因を知るためにエラーの内容を説明します。
  </p>
  
  <pre>FFFTP inner Error.
No more async regist space
▼訳
FFFTP 内部エラー
Asyncの登録スペースが、いっぱいになりました
</pre>
  
  <p>
    <span style="float: right; padding: 0 0 10px 15px; width: 33%; text-align: center;"><img style="width: 100%;" title="" src="http://pds.exblog.jp/pds/1/200807/12/07/e0011707_2283374.jpg" alt="" />インナー・エラーの例</span>
  </p>
  
  <p>
    1行目は&#8221;inner&#8221;つまり内部にエラーが発生したという意味です。
  </p>
  
  <p>
    次に、2行目のエラーメッセージにある&#8221;async&#8221;というのは&#8221;asynchronous&#8221;の略で「非同期」という意味です。
  </p>
  
  <p>
    この「非同期」とは「同期されない」という意味ではなく「任意のタイミングでデータを送信する通信方式」という意味なのですが、わかりづらいですよね。
  </p>
  
  <h4 id="outline__2">
    同期と非同期
  </h4>
  
  <div style="float: right; padding: 0 0 10px 15px; width: 33%;">
    <img style="width: 100%;" title="西城秀樹" src="https://images-na.ssl-images-amazon.com/images/I/51KbOwkltwL.jpg" alt="" /></p> 
    
    <div style="text-align:center">
      ドキッ
    </div>
    
    <p>
      <img style="width: 100%;" title="西城秀樹" src="http://ecx.images-amazon.com/images/I/51pTlzHBrEL._SL500_AA300_.jpg" alt="" />
    </p>
    
    <div style="text-align:center">
      ヒデキ
    </div>
  </div>
  
  <p>
    実は、パソコンやインターネットなど、通信を行う業界では「同期」と「非同期」という言葉がよく使われます。<br /> 映画やドラマで警備員さんがトランシーバーを使って話すシーンを想像してみてください。柳沢慎吾さんの警察官のモノマネでもいいです。話す時は「つなげて→話す→切る」という動作、あれが「非同期通信」と呼ばれるものです。<br /> では「同期」の場合はと言うと「相手にかけた電話」が同期通信になります。つまり「つながりっぱなし」状態なので「話す」だけで済むわけです。
  </p>
  
  <p>
    FTPは、ファイルをアップロードする場合「サーバに接続→転送→切断」という動作を行うので「非同期」通信ということになります。
  </p>
  
  <p>
    恐らく今回の、このエラーが出る際、作業中ファイルをアップロードしても、1回目でアップロードされないケースが何度か続いていたと思います。<br /> つまり「あれ? 反映されてないぞ?アップに失敗したかな?」といったケースです。イメージとしては、トランシーバーで話しているのに反応がなく「あれ?聞こえてるのかな?」といった状態でしょうか。
  </p>
  
  <p>
    その度に、ファイルのアップロード作業を繰り返すわけですが、実は再接続せずに、保留のまま別の接続を作っていることがあります。つまり、相手から反応がないので別のトランシーバーを用意してつなげていると考えて下さい。
  </p>
  
  <p>
    そうなると、トランシーバーが増える＝接続数が増えることになるので、もうトランシーバーがない＝アプリの許容範囲を超えた時に&#8221;No more async regist space&#8221;を表示して終了するわけです。
  </p>
  
  <p>
    そもそもサーバからの返事が遅い事が原因なのですが、アプリも共倒れ状態というわけです。
  </p>
  
  <h4 id="outline__3">
    サーバーの反応が遅い原因
  </h4>
  
  <p>
    何といっても、サーバーに負荷がかかっていて、サーバーそのものが一杯一杯な場合が一番多い原因でしょう。
  </p>
  
  <p>
    一般的なWEBサーバの場合は、共有サーバ型といって、１台のサーバーを複数人でシェアして使います。これによりコスト抑えられるので、安くWEBサイトを持てるわけです。
  </p>
  
  <p>
    しかし、同じサーバーで他のユーザーが負荷をかけている場合、自分も、とばっちりを受けていることになります。
  </p>
  
  <p>
    この場合は、管理人に言って迷惑をかけている人を何とかしてもらうか、我慢するか、別のサーバに引っ越すことになります。マンションと同じですね。
  </p>
  
  <p>
    しかし、実は別の事が原因で遅くなる場合もあります。ValueDomainで独自ドメインを取得して、XreaをWEBサーバにしている方は特にあるかもしれません。
  </p>
  
  <h5 id="outline__3_1">
    チェック事項
  </h5>
  
  <ul>
    <li>
      FTPだけでなくWEBサイトも反応が遅いか
    </li>
    <li>
      独自ドメインの場合、エイリアス(※1)でアクセスしても遅いか
    </li>
    <li>
      FTPサーバの設定で、IPアドレスに変更してどうか(※2)
    </li>
  </ul>
  
  <p>
    ※1) ここで言うエイリアスとは、WEBサーバの契約時に独自ドメインとは別にWEBサーバー側で用意したサブ・ドメインのアドレスです。例) hogehoge.s324.xrea.com
  </p>
  
  <p>
    ※2) FFFTPでFTPサーバを&#8221;s324.xrea.com&#8221;といったドメイン名で指定している場合、IPアドレスで接続します。
  </p>
  
  <p>
    (つづく)
  </p>
</div>