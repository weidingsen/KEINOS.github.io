---
title: QNAP で名前解決ができないが DNS には Ping は通る
author: KEINOS
type: post
date: 2018-03-08T08:06:14+00:00
url: /20180308_3640
yuzo_related_post_metabox:
  - 'a:3:{s:17:"yuzo_include_post";s:0:"";s:17:"yuzo_exclude_post";s:0:"";s:21:"yuzo_disabled_related";N;}'
post_views_count:
  - 1569
categories:
  - ルーター
tags:
  - DNS
  - NAS
  - QNAP
  - nslookup
  - ping

---
## TL;DR {#outline__1}

  * ルーターで特定IPアドレスからの通信を外部にブロック（パケットフィルタ設定を行なっているなど）していませんか？
  * AmazonDashButton など、外部に勝手に通信する端末の Hack で、外部アクセスをブロックをした事はありませんか？

## TS;DR {#outline__2}

### 現象 {#outline__2_1}

  * 特定IPアドレス（今回の場合は QNAP の NAS）でアップデートなどに失敗する

### 切り分け {#outline__2_2}

大きく３段階にわけて切り分けをします。

  1. 端末固有の問題か、LAN内全体の問題か
  2. LAN内（ルータより内側）に問題がないか
  3. どこがブロックしているかの特定

この記事を読んでいるということは、ある程度の切り分けを行ったあとだと思います。「すでに試した」と慌てずに、チェック事項を１つ１つずつ潰して、**急がば回れで行きましょう**。

#### 端末固有の問題か、LAN内全体の問題か {#outline__2_2_1}

| 切り分け                                                   | OKの場合                 | NGの場合    |
|:------------------------------------------------------ |:--------------------- |:-------- |
| 他の端末/マシンから外部（インターネット）にブラウザで接続できるか                      | 特定端末やLANケーブルなどの問題     | LAN全体の問題 |
| 他の端末/マシンからルータより外（インターネット）に`ping`が通るか（`ping 8.8.8.8`など） | 特定端末の問題               | LAN全体の問題 |
| ルータ→HUB→端末の順に電源を入れ直してどうか                               | 設定が反映されていなかった可能性があります | LAN全体の問題 |

LAN全体の問題ということは、ルータ、HUB 、ONU（光回線などの終端装置）に問題があります。一番多いのが、実は LAN 配線でなく、WiFi に問題があったり、再起動が上手くいかなかった場合なので、ルーターの再起動（電源再投入）をしておきましょう。

また、「通信できていた」という思い込みで配線を疑わずに、実はケーブルなどに問題があったということが多々あります。特に LAN ケーブルなどはドアなどに挟まれて皮一枚でも通信が出来たりするので、**まずは物理に問題がないかを先に確認して潰し込んでおく**ことをおすすめします。ルータや HUB の場合は、念のために LAN ケーブルを抜き差ししてポートのランプが点灯/点滅する（通電している）ことを確認します。

次に ONU あたりが原因で見落としがちなのが、プロバイダや通信接続業者の料金を払い忘れてブロックされているなどです。

その上で、他の端末/マシンから問題ない場合は、次に進みます。

#### LAN内（ルータより内側）に問題がないか {#outline__2_2_2}

| 切り分け                                  | OKの場合           | NGの場合                                         |
|:------------------------------------- |:--------------- |:--------------------------------------------- |
| ルータ側の設定で特定ポート/IPアドレス/パケットをフィルターしていないか | ルータの個別設定が原因ではない | ルータでブロックしていた                                  |
| 問題の端末/NAS へ `ping IPアドレス` は通るか        | LAN内は問題なし       | LANケーブル、HUBのポート、もしくは端末/NAS が正常に起動していないなどの問題あり |
| 問題の端末/NAS へログインできるか                   | 端末/NAS は生きている   | 問題の端末/NAS でアップデートなど、何かしらのエラーが発生している可能性あり      |

#### どこがブロックしているかの特定 {#outline__2_2_3}

| 切り分け                                                | OKの場合                           | NGの場合                                    |
|:--------------------------------------------------- |:------------------------------- |:---------------------------------------- |
| 問題の端末/NAS からLAN内の別端末へ `ping IPアドレス`は通るか             | イントラネット（LAN内）の通信は問題なし           | 全ての端末に対して通らない場合は問題の端末/NAS でブロックしている可能性あり |
| 問題の端末/NAS から外部へ `ping IP アドレス`は通るか                  | 端末/NAS → ルーター → インターネットの通信は問題なし | DNS関連に問題あり                               |
| 問題の端末/NAS から外部へ `ping ホスト名`は通るか                     | 端末/NAS → ルーター → インターネットの通信は問題なし | DNS関連に問題あり                               |
| 問題の端末/NAS で`nslookup ホスト名`でIPアドレスに名前解決できるか          | DNS関連に問題あり                      |                                          |
| 問題の端末/NAS から正常動作する端末に設定された DNS の IPアドレスに`ping`してどうか | DNSは見えている                       | ルータに問題あり                                 |
| 問題の端末/NAS と正常動作の端末の DNS の IPアドレスを同じにしてどうか           | DNS指定先に問題なし                     | DNS関連に問題あり                               |