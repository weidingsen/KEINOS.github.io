---
title: 弥生会計からFilemakerProへ勘定科目と補助科目をインポートする
author: KEINOS
type: post
date: 2012-07-16T04:30:32+00:00
url: /20120716_878
page_type:
  - default
post_views_count:
  - 667
categories:
  - Filemaker
  - 弥生会計
tags:
  - CSV
  - Microsoft SQLサーバー
  - ODBC
  - 勘定科目/補助科目

---
## 弥生会計12の勘定科目と補助科目をFilemakerに取り込んで科目マスターに利用する {#outline__1}

<div class="section">
  <p>
    FileMakerで仕訳データを作成して弥生会計で集計をしたい場合など、FileMakerと弥生会計と連携をする際、勘定科目や補助科目に合わせた税区分や税計算区分などを同じにする必要あります。（弥生会計とFilemakerの同期）
  </p>
  
  <p>
    その場合に、問題なのは弥生会計とFileMakerの、どちらの設定をマスターとするかだと思います。
  </p>
  
  <p>
    弥生会計はインポート機能が十分でないため、外部CSVファイルから勘定科目や補助科目の自動登録はできません。(手打ち後にサーチキーなどの変更はインポートでできますが、補助科目が大量にあると泣きそうになりますよね)
  </p>
  
  <p>
    そのため、前期繰越金の初回入力と同様、勘定科目や補助科目は基本、手入力になります。
  </p>
  
  <p>
    そこで、弥生会計に頑張って入力した勘定科目と補助科目をマスター(親)とするのが得策になるのですが、FileMaker側との科目の同期は、弥生会計からエクスポートしてFileMakerへのインポートになります。
  </p>
  
  <p>
    参照という意味では、弥生会計はMicrosoft SQLサーバーを使っているので、実はODBCなどを使っての外部ファイルとしてのアクセスも可能なのですが、けっこう簡単に弥生側のファイルが壊れてしまいます。
  </p>
  
  <p>
    その壊れる頻度とリスクと、更新頻度を考えると、いささか手間ではありますが、やはり弥生会計から勘定科目のリストをCSVファイルにエクスポートして、FileMaker側にインポートするのが得策だと感じました。ちなみに、CSVの出力タイプは「汎用形式」がいいでしょう。(補助科目は汎用形式でしかエクスポートできないため)
  </p>
  
  <h3 id="outline__1_1">
    勘定科目テーブルと補助科目テーブルのリレーション
  </h3>
  
  <p>
    弥生会計からエクスポートした、勘定科目と補助科目のCSVファイルは、「勘定科目名」で紐付ける（リレーションさせる）仕様になっています。サーチキーなど、科目コードではありません。
  </p>
  
  <p>
    問題は、その勘定科目側のフォーマットで、カテゴリ（階層）が6階層になっているため、どの階層に、補助科目が所属する勘定科目があるかわからず、リレーションさせるのに苦労します。
  </p>
  
  <p>
    そこで、下手に自己リレーション、再帰処理、値一覧といったテクニックを使わずに、弥生会計の仕様を利用した、シンプルな方法で解決します。
  </p>
  
  <h3 id="outline__1_2">
    ■弥生会計の勘定科目のCSVエクスポート仕様
  </h3>
  
  <ol>
    <li>
      勘定科目名のある行(レコード)は「[表題行]」の列の値が「[明細行]」である
    </li>
    <li>
      カテゴリ名は&#8221;[&#8220;と&#8221;]&#8221;の大括弧で括られており、勘定科目名には大括弧がない
    </li>
  </ol>
  
  <pre class="syntax-highlight">
&#34;帳票名&#34;,&#34;勘定科目一覧表&#34;↓
&#34;書式名&#34;,&#34;汎用形式&#34;↓
&#34;事業所名&#34;,&#34;My事業所名&#34;↓
&#34;処理日時&#34;,&#34;平成24年07月16日&#34;,&#34;23:10:01&#34;↓
&#34;[表題行]&#34;,&#34;階層１&#34;,&#34;階層２&#34;,&#34;階層３&#34;,&#34;階層４&#34;,&#34;階層５&#34;,&#34;階層６&#34;,&#34;サーチキー１&#34;,&#34;サーチキー２&#34;,&#34;サーチキー３&#34;,&#34;貸借区分&#34;,&#34;税区分&#34;,&#34;税計算区分&#34;,&#34;税端数処理&#34;,&#34;簡易課税事業区分&#34;,&#34;補助必須&#34;,&#34;決算書項目&#34;,&#34;非表示&#34;↓
&#34;[区分行]&#34;,&#34;[資産]&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;↓
&#34;[区分行]&#34;,&#34;[資産]&#34;,&#34;[流動資産]&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;↓
&#34;[区分行]&#34;,&#34;[資産]&#34;,&#34;[流動資産]&#34;,&#34;[現金･預金]&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;*GENYOKI&#34;,&#34;*ｹﾞﾝﾖｷﾝ&#34;,&#34;*100&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;,&#34;&#34;↓
&#34;[明細行]&#34;,&#34;[資産]&#34;,&#34;[流動資産]&#34;,&#34;[現金･預金]&#34;,&#34;現金&#34;,&#34;&#34;,&#34;&#34;,&#34;GENKIN&#34;,&#34;ｹﾞﾝｷﾝ&#34;,&#34;1110&#34;,&#34;[借方]&#34;,&#34;対象外&#34;,&#34;&#34;,&#34;[指定なし]&#34;,&#34;&#34;,&#34;no&#34;,&#34;現金及び預金&#34;,&#34;no&#34;↓
&#34;[明細行]&#34;,&#34;[資産]&#34;,&#34;[流動資産]&#34;,&#34;[現金･預金]&#34;,&#34;現場勘定&#34;,&#34;&#34;,&#34;&#34;,&#34;GENBAKA&#34;,&#34;ｹﾞﾝﾊﾞｶﾝ&#34;,&#34;1111&#34;,&#34;[借方]&#34;,&#34;対象外&#34;,&#34;&#34;,&#34;[指定なし]&#34;,&#34;&#34;,&#34;yes&#34;,&#34;現場勘定&#34;,&#34;no&#34;↓
&#34;[明細行]&#34;,&#34;[資産]&#34;,&#34;[流動資産]&#34;,&#34;[現金･預金]&#34;,&#34;当座預金&#34;,&#34;&#34;,&#34;&#34;,&#34;TOUZAYO&#34;,&#34;ﾄｳｻﾞﾖｷﾝ&#34;,&#34;1120&#34;,&#34;[借方]&#34;,&#34;対象外&#34;,&#34;&#34;,&#34;[指定なし]&#34;,&#34;&#34;,&#34;yes&#34;,&#34;現金及び預金&#34;,&#34;no&#34;↓
(以下略。↓は改行)
</pre>
  
  <h3 id="outline__1_3">
    ■基本的な流れ
  </h3>
  
  <ol>
    <li>
      勘定科目と補助科目用のテーブルを作成<br />弥生会計からエクスポートした勘定科目と補助科目の汎用形式のCSVファイルを、インポートさせるテーブルを各々作成 (例「勘定科目テーブル」「補助科目テーブル」)
    </li>
    <li>
      CSVを「勘定科目テーブル」と「補助科目テーブル」に各々インポートするスクリプトを作成※
    </li>
    <li>
      「補助科目テーブル」とリレーションさせるためのフィールドを「勘定科目テーブル」側に新たに作る
    </li>
    <li>
      上記のインポート用スクリプトに、インポート後に「フィールド内容の全置換」で「階層１～６」の列を参照して、&#8221;[]&#8221;(大括弧)がない列のデータをリレーション用のフィールドにコピーする
    </li>
  </ol>
  
  <p>
    ※このとき、インポートしたヘッダー部の5行(頭から5レコードぶん)を削除するようにします。
  </p>
  
  <p>
    以上で、科目名でリレーションできるテーブルが出来上がります。補助科目テーブルの「[所属勘定科目]」列とリレーションさせるといいでしょう。
  </p>
  
  <p>
    以下は上記の「フィールド内容の全置換」の置換式。
  </p>
  
  <pre>
Case(
表題行 = "[明細行]" and Left( 階層１; 1 )  ≠  "[" and Right( 階層１ ; 1 )  ≠  "]"; 階層１;
表題行 = "[明細行]" and Left( 階層２; 1 )  ≠  "[" and Right( 階層２ ; 1 )  ≠  "]"; 階層２;
表題行 = "[明細行]" and Left( 階層３; 1 )  ≠  "[" and Right( 階層３ ; 1 )  ≠  "]"; 階層３;
表題行 = "[明細行]" and Left( 階層４; 1 )  ≠  "[" and Right( 階層４ ; 1 )  ≠  "]"; 階層４;
表題行 = "[明細行]" and Left( 階層５; 1 )  ≠  "[" and Right( 階層５ ; 1 )  ≠  "]"; 階層５;
表題行 = "[明細行]" and Left( 階層６; 1 )  ≠  "[" and Right( 階層６ ; 1 )  ≠  "]"; 階層６;
""
)
</pre>
</div>